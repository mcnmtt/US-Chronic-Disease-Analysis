---
title: "Matrici di Correlazione"
output: html_notebook
---

**RQ:** *I dati presenti nel dataset sono utili al fine di effettuare predizione sui fenomeni contenuti dallo stesso?*

# Filtro topic: Diabetes & Cardiovascular Disease

```{r}
library(dplyr)  
dataset_path <- "u_s_chronic_disease_indicators_cdi.csv"  

df <- read.csv(dataset_path, na.strings = c("", "NA", "NULL", "null"))  

df_filtered <- df %>%   
  filter(topic %in% c("Diabetes", "Cardiovascular Disease")) 
```

```{r}
library(dplyr)                                              
library(tidyr)                                            
library(corrplot)                                            # grafico di correlazione

mean_values <- df_filtered %>%                               # parte dal dataframe filtrato
  filter(datavaluetype == "Age-adjusted Prevalence",         # seleziona il tipo di valore
         stratificationcategory1 == "Overall",               # tiene solo overall
         locationabbr != "US",                               # esclude totale usa
         !is.na(datavalue)) %>%                              # rimuove valori mancanti
  mutate(datavalue = as.numeric(datavalue)) %>%              # converte datavalue in numerico
  group_by(questionid, locationabbr) %>%                     # raggruppa per domanda e stato
  summarise(mean_value = mean(datavalue, na.rm = TRUE), .groups = "drop")  # calcola media per gruppo

mean_wide <- mean_values %>%                                 # prepara formato wide
  pivot_wider(names_from = questionid, values_from = mean_value)  # colonne per questionid con media

esclusi <- setdiff(unique(df$questionid), unique(mean_values$questionid))  # questionid assenti nella media

print(esclusi)                                               # stampa la lista degli esclusi

df_numeric <- mean_wide %>%                                  # prepara dati numerici per correlazione
  select(where(is.numeric))                                  # seleziona solo colonne numeriche

correlation_matrix <- cor(df_numeric,                        # calcola matrice di correlazione
                          use = "pairwise.complete.obs",     # usa coppie complete
                          method = "pearson")                # coefficiente di pearson

corrplot(correlation_matrix,                                 # disegna la matrice di correlazione
         method = "color",                                   # celle colorate
         type = "upper",                                     # triangolo superiore
         order = "hclust",                                   # ordina per similaritÃ 
         addCoef.col = "black",                              # mostra coefficienti in nero
         tl.col = "black",                                   # colore etichette
         tl.srt = 45,                                        # rotazione etichette
         diag = FALSE)                                       # nasconde la diagonale

```
