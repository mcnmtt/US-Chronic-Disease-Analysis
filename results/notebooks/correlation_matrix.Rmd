---
title: "Matrici di Correlazione"
output: html_notebook
---

**RQ:** *I dati presenti nel dataset sono utili al fine di effettuare predizione sui fenomeni contenuti dallo stesso?*

# Filtro topic: Diabetes & Cardiovascular Disease

```{r}
library(dplyr)  
dataset_path <- "u_s_chronic_disease_indicators_cdi.csv"  

df <- read.csv(dataset_path, na.strings = c("", "NA", "NULL", "null"))  

df_filtered <- df %>%   
  filter(topic %in% c("Diabetes", "Cardiovascular Disease")) 
```

```{r}
library(dplyr)
library(tidyr) 
library(corrplot)

mean_values <- df_filtered %>%
  filter(datavaluetype == "Crude Prevalence",
         stratificationcategory1 == "Overall",
         locationabbr != "US",
         !is.na(datavalue)) %>%
  mutate(datavalue = as.numeric(datavalue)) %>%
  group_by(questionid, locationabbr) %>%
  summarise(mean_value = mean(datavalue, na.rm = TRUE), .groups = "drop")

mean_wide <- mean_values %>%
  pivot_wider(names_from = questionid, values_from = mean_value)

esclusi <- setdiff(unique(df$questionid),unique(mean_values$questionid))

print(esclusi)

# Rimuovi la colonna con i nomi degli stati (locationabbr) per calcolare la correlazione solo sui numeri
df_numeric <- mean_wide %>%
  select(where(is.numeric))

# Calcolo matrice di correlazione
correlation_matrix <- cor(df_numeric, use = "pairwise.complete.obs", method = "pearson")

# Visualizzazione con corrplot
corrplot(correlation_matrix,
         method = "color",       # celle colorate
         type = "upper",         # mostra solo triangolo superiore
         order = "hclust",       # ordina le variabili per similaritÃ 
         addCoef.col = "black",  # mostra i numeri della correlazione
         tl.col = "black",       # colore dei nomi delle variabili
         tl.srt = 45,            # rotazione etichette
         diag = FALSE)           # non mostra la diagonale

```
